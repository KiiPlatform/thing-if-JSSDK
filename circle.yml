machine:
  node:
    version: v6.1.0
dependencies:
  post:
    # install typings of dependencies
    - typings install
test:
  pre:
    # generate typedoc
    - npm run build-doc; cp -fr ./jsdoc/html $CIRCLE_ARTIFACTS/

    # uglify library
    - >
      npm run build-src-uglify &&
      cp ./dist/thing-if.js $CIRCLE_ARTIFACTS/thing-if-min.js &&
      cp ./dist/thing-if.js.map $CIRCLE_ARTIFACTS/thing-if-min.js.map

   # build sdk
    - npm run build-src
    - cp ./dist/thing-if* $CIRCLE_ARTIFACTS/
  post:
    - npm run test-cov
deployment:
  npm:
    tag: /^[0-9]+(\.[0-9]+){0,2}((-.*)?)?$/
    commands:
      - echo "//registry.npmjs.org/:_authToken=${NPM_AUTHTOKEN}" >> .npmrc; npm publish ./
      - bash ./circleci_scripts/release_doc.sh
