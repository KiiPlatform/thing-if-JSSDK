dependencies:
  post:
    # install typings of dependencies
    - typings install
test:
  pre:
    # generate typedoc
    - gulp doc; cp -fr ./jsdoc/html $CIRCLE_ARTIFACTS/

    # uglify library
    - gulp --u
    - cp ./dist/thing-if-sdk* $CIRCLE_ARTIFACTS/

   # build sdk
    - gulp
    - cp ./dist/thing-if-sdk* $CIRCLE_ARTIFACTS/
  post:
    - npm run test-cov
deployment:
  npm:
    tag: /^[0-9]+(\.[0-9]+){0,2}((-.*)?)?$/
    commands:
      - echo "//registry.npmjs.org/:_authToken=${NPM_AUTHTOKEN}" >> .npmrc; npm publish ./
      - bash ./circleci_scripts/release_doc.sh
